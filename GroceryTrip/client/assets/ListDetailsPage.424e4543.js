import{n as v,l as c,A as a,q as C,s as S,_ as G,u as R,w as B,g as A,c as I,v as w,P as l,x as b,L as D,j as E,b as u,d as r,t as k,F as P,y as j,z as T,B as q,C as F,f as x,D as M,o as m,E as O,p as V,k as z,r as N}from"./index.fcae9d8d.js";import{s as H}from"./SearchesService.cccbab87.js";class K{async addItem(e){const i=await v.post("api/groceryItems",e);c.log(i.data),a.activeGroceryListItems.push(i.data)}async deleteItem(e){await v.delete("api/groceryItems/"+e),c.log("deleting item",e),a.activeGroceryListItems=a.activeGroceryListItems.filter(i=>i.id!=e)}async getItemsOnList(e){const i=await v.get("api/lists/"+e+"/items");c.log(i.data),a.activeGroceryListItems=i.data,a.loading=!1}async toggleInclude(e){const i=a.activeGroceryListItems.find(s=>s.id==e);i.included=!i.included,await v.put("api/groceryItems/"+e)}async sortListResults(e,i){a.loading=!0;const s=await H.searchList(e);a.loading=!1;let t=[];c.log(s);let n=e.query;for(let y=0;y<n.length;y++){let o=s[n[y]].map(g=>new C(g)).filter(g=>g.price!=null);if(i=="price"){const g=o.sort((p,L)=>p.price-L.price);t.push(g[0])}else{const g=o.sort((p,L)=>p.distance-L.distance);t.push(g[0])}}await S.addListToTrip(t)}}const h=new K;const U={setup(){const d=M(),e=R({});async function i(){try{const t=d.params.listId;await w.getListById(t)}catch(t){c.error(t),l.error(t.message)}}async function s(){try{const t=d.params.listId;await h.getItemsOnList(t)}catch(t){a.loading=!1,c.error(t),l.error(t.message)}}return B(()=>{a.account.id&&(i(),s())}),A(()=>{a.activeGroceryListItems=[]}),{editable:e,loading:I(()=>a.loading),groceryList:I(()=>a.activeGroceryList),groceryListItems:I(()=>a.activeGroceryListItems),toggle:I(()=>a.toggle),switchToggle(){try{w.toggleForm(),e.value={}}catch(t){c.error(t),l.error(t.message)}},async addItem(){e.value.listId=d.params.listId,c.log("adding item",e.value);try{await h.addItem(e.value)}catch(t){c.error(t),l.error(t.message)}e.value={}},async deleteItem(t){try{await l.confirm("are you sure you want to delete this item?")&&await h.deleteItem(t)}catch(n){c.error(n),l.error(n.message)}},async deleteList(){if(await l.confirm("Are you sure you want to delete this list?"))try{await w.deleteList(d.params.listId),b.push("/")}catch(t){c.error(t),l.error(t.message)}},async toggleInclude(t){try{await h.toggleInclude(t)}catch(n){c.error(n),l.error(n.message)}},async addListToTrip(){try{const t=[];a.activeGroceryListItems.forEach(o=>{o.included&&t.push(o.name)});const n=a.account.locations,y={query:t,locations:n},_=await l.filterButtons();_&&(await h.sortListResults(y,_),b.push({name:"Home"}))}catch(t){c.error(t),l.error(t.message),a.loading=!1}}}},components:{Loading:D}},f=d=>(V("data-v-9c013cf5"),d=d(),z(),d),J={key:1,class:""},Q={class:"bigger p-3 text-light"},W={class:"container-fluid"},X=["onClick"],Y=f(()=>r("div",{class:"filler"},null,-1)),Z={class:"text-light d-flex"},$={class:"my-3 col-8"},ee={class:"text-end my-2 col"},te=["onClick","disabled"],se=f(()=>r("i",{class:"mdi mdi-delete-outline"},null,-1)),oe=[se],re={key:0,class:"excluded bg-light"},ae={key:1,class:"filler"},ie={key:0,class:""},ce={class:"col-10 p-0"},ne=f(()=>r("button",{class:"btn btn-primary col-2"},"Add",-1)),le={class:"text-center"},de=f(()=>r("i",{class:"mdi mdi-note-plus-outline"}," Add Item",-1)),ge=[de],me={class:"container-fluid"},ye=f(()=>r("div",{class:"row"},null,-1)),ue={class:"row justify-content-evenly my-3"};function _e(d,e,i,s,t,n){var _;const y=N("Loading");return s.loading?(m(),E(y,{key:0})):(m(),u("div",J,[r("h1",Q,k((_=s.groceryList)==null?void 0:_.name),1),r("ul",W,[(m(!0),u(P,null,j(s.groceryListItems,(o,g)=>(m(),u("div",{role:"button",class:O(["no-select row p-2 justify-content-between",{"bg-grey":g%2==0},{"opacity-50 bg-dark":!o.included}]),onClick:p=>s.toggleInclude(o.id)},[Y,r("li",Z,[r("h5",$,"\u2022"+k(o.name),1),r("div",ee,[r("button",{onClick:T(p=>s.deleteItem(o.id),["stop"]),class:"btn text-danger btn-dark",title:"Remove Item",disabled:!o.included},oe,8,te)])]),o.included?(m(),u("div",ae)):(m(),u("div",re))],10,X))),256)),s.toggle?(m(),u("div",ie,[r("form",{class:"row m-2",onSubmit:e[1]||(e[1]=T((...o)=>s.addItem&&s.addItem(...o),["prevent"]))},[r("div",ce,[q(r("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.editable.name=o),class:"form-control",type:"text"},null,512),[[F,s.editable.name]])]),ne],32),r("div",le,[r("button",{onClick:e[2]||(e[2]=(...o)=>s.switchToggle&&s.switchToggle(...o)),class:"col-3 btn btn-secondary border-warning text-warning"},"Cancel")])])):x("",!0),s.toggle?x("",!0):(m(),u("button",{key:1,onClick:e[3]||(e[3]=(...o)=>s.switchToggle&&s.switchToggle(...o)),class:"my-3 btn btn-dark"},ge))]),r("div",me,[ye,r("div",ue,[r("button",{onClick:e[4]||(e[4]=(...o)=>s.deleteList&&s.deleteList(...o)),class:"btn btn-secondary border-danger text-danger col-4"},"Delete List"),r("button",{onClick:e[5]||(e[5]=(...o)=>s.addListToTrip&&s.addListToTrip(...o)),class:"col-5 btn btn-primary py-2"},"Add List to Trip")])])]))}const fe=G(U,[["render",_e],["__scopeId","data-v-9c013cf5"]]);export{fe as default};
